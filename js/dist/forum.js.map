{"version":3,"sources":["webpack://@mircle/group-list/webpack/bootstrap","webpack://@mircle/group-list/external \"flarum.core.compat['forum/app']\"","webpack://@mircle/group-list/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@mircle/group-list/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@mircle/group-list/external \"flarum.core.compat['common/Model']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/Button']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@mircle/group-list/./src/common/models/GroupListItem.js","webpack://@mircle/group-list/external \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/utils/Stream']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/utils/withAttr']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/Page']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/helpers/listItems']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/Modal']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/LinkButton']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/extend']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/GroupBadge']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/components/Link']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/helpers/avatar']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/helpers/username']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/helpers/userOnline']\"","webpack://@mircle/group-list/external \"flarum.core.compat['common/Component']\"","webpack://@mircle/group-list/./src/forum/components/UserList.js","webpack://@mircle/group-list/./src/forum/components/GroupApplicationModal.js","webpack://@mircle/group-list/./src/forum/components/GroupListPage.js","webpack://@mircle/group-list/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@mircle/group-list/./src/forum/components/GroupApplicationReviewModal.js","webpack://@mircle/group-list/./src/forum/components/GroupApplicationItem.js","webpack://@mircle/group-list/./src/forum/components/GroupApplicationListPage.js","webpack://@mircle/group-list/./src/common/models/GroupApplication.js","webpack://@mircle/group-list/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","GroupListItem","content","Model","attribute","contentHtml","group","hasOne","members","hasMany","UserList","view","vnode","attrs","users","map","user","Link","href","app","route","avatar","badges","hideBadgeId","forum","userOnline","username","has","remove","listItems","toArray","GroupApplicationModal","oninit","this","reason","Stream","uploadedFiles","loading","className","title","translator","trans","nameSingular","rows","placeholder","oninput","withAttr","type","multiple","accept","onchange","uploadFiles","length","style","file","idx","src","url","onclick","removeImage","disabled","trim","event","Array","from","target","files","forEach","formData","FormData","append","request","method","body","headers","session","token","serialize","raw","then","response","fileData","data","push","attributes","redraw","error","console","alerts","show","splice","onsubmit","e","preventDefault","imagesHtml","join","fullContent","groupId","id","hide","Modal","GroupListPage","items","store","pushPayload","bodyClass","IndexPage","hero","sidebarItems","LoadingIndicator","component","item","GroupBadge","namePlural","trust","showApplyButton","Button","modal","groups","some","userGroup","Page","_extends","assign","arguments","source","apply","GroupApplicationReviewModal","application","status","reviewComment","userRelation","relationships","groupRelation","includedData","userData","groupData","userName","displayName","groupName","innerHTML","onUpdate","GroupApplicationItem","reviewerRelation","reviewer","reviewerData","reviewerName","statusClass","date","createdAt","Date","toLocaleString","year","month","day","hour","minute","reviewedAt","Component","GroupApplicationListPage","applications","statusFilter","loadApplications","included","onStatusFilterChange","newStatus","emptyText","isReviewer","pageTitle","applicationCount","countText","GroupApplication","apiEndpoint","initializers","add","routes","path","models","extend","LinkButton","icon"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 25);\n","module.exports = flarum.core.compat['forum/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","import Model from 'flarum/common/Model';\r\n\r\nexport default class GroupListItem extends Model {\r\n    content = Model.attribute('content');\r\n    contentHtml = Model.attribute('contentHtml');\r\n\r\n    group = Model.hasOne('group');\r\n    members = Model.hasMany('members');\r\n}\r\n","module.exports = flarum.core.compat['forum/components/IndexPage'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['common/utils/withAttr'];","module.exports = flarum.core.compat['common/components/Page'];","module.exports = flarum.core.compat['common/helpers/listItems'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['common/components/LinkButton'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/components/GroupBadge'];","module.exports = flarum.core.compat['common/components/Link'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/helpers/userOnline'];","module.exports = flarum.core.compat['common/Component'];","import Link from 'flarum/common/components/Link';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport listItems from 'flarum/common/helpers/listItems';\r\nimport username from 'flarum/common/helpers/username';\r\nimport userOnline from 'flarum/common/helpers/userOnline';\r\n\r\n/* global app, m, $ */\r\n\r\nexport default class UserList {\r\n    view(vnode) {\r\n        return m('ul.GroupList-UserList', vnode.attrs.users.map(user => {\r\n\r\n            return m('li.GroupList-UserList-item', m(Link, {\r\n                href: app.route.user(user),\r\n            }, [\r\n                m('.GroupList-UserList-avatar', [\r\n                    avatar(user),\r\n                    this.badges(user, vnode.attrs.hideBadgeId),\r\n                ]),\r\n                m('.GroupList-UserList-user', [\r\n                    app.forum.attribute('mircle-group-list.showOnlineStatus') ? userOnline(user) : null,\r\n                    username(user),\r\n                ]),\r\n            ]));\r\n        }));\r\n    }\r\n\r\n    badges(user, hideBadgeId) {\r\n        if (!app.forum.attribute('mircle-group-list.showAvatarBadges')) {\r\n            return null;\r\n        }\r\n\r\n        const badges = user.badges();\r\n\r\n        if (badges.has(hideBadgeId)) {\r\n            badges.remove(hideBadgeId);\r\n        }\r\n\r\n        return m('ul.badges', listItems(badges.toArray()));\r\n    }\r\n}\r\n","import app from 'flarum/forum/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport withAttr from 'flarum/common/utils/withAttr';\r\n\r\n/* global m */\r\n\r\nexport default class GroupApplicationModal extends Modal {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n        this.group = this.attrs.group;\r\n        this.reason = Stream(''); // 申请理由\r\n        this.uploadedFiles = []; // 图片数组\r\n        this.loading = false;\r\n    }\r\n\r\n    className() {\r\n        return 'GroupApplicationModal Modal--small';\r\n    }\r\n\r\n    title() {\r\n        return app.translator.trans('mircle-group-list.forum.apply.title', { group: this.group.nameSingular() });\r\n    }\r\n\r\n    content() {\r\n        return (\r\n            <div className=\"Modal-body\">\r\n                <div className=\"Form\">\r\n                    <div className=\"Form-group\">\r\n                        <label>{app.translator.trans('mircle-group-list.forum.apply.content_label')}</label>\r\n                        <textarea\r\n                            className=\"FormControl\"\r\n                            rows=\"4\"\r\n                            placeholder={app.translator.trans('mircle-group-list.forum.apply.content_placeholder')}\r\n                            value={this.reason()}\r\n                            oninput={withAttr('value', this.reason)}\r\n                        />\r\n                    </div>\r\n                    <div className=\"Form-group\">\r\n                        <label>{app.translator.trans('mircle-group-list.forum.apply.images_label')}</label>\r\n                        <input\r\n                            type=\"file\"\r\n                            className=\"FormControl\"\r\n                            multiple\r\n                            accept=\"image/*\"\r\n                            onchange={this.uploadFiles.bind(this)}\r\n                        />\r\n                        <div className=\"helpText\">\r\n                            {app.translator.trans('mircle-group-list.forum.apply.upload_images')}\r\n                        </div>\r\n                        {this.uploadedFiles.length > 0 && (\r\n                            <div style=\"margin-top:10px;\">\r\n                                {this.uploadedFiles.map((file, idx) => (\r\n                                    <span style=\"display:inline-block;margin-right:8px;position:relative;\" key={idx}>\r\n                                        <img src={file.url} style=\"max-width:80px;max-height:80px;border-radius:4px;\" />\r\n                                        <span\r\n                                            style=\"position:absolute;top:0;right:0;background:#f44;color:#fff;border-radius:50%;width:18px;height:18px;line-height:18px;text-align:center;cursor:pointer;font-size:12px;\"\r\n                                            onclick={() => { this.removeImage(idx); }}\r\n                                        >×</span>\r\n                                    </span>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"Form-group\">\r\n                        <Button\r\n                            className=\"Button Button--primary\"\r\n                            type=\"submit\"\r\n                            loading={this.loading}\r\n                            disabled={!this.reason().trim()}\r\n                        >\r\n                            {app.translator.trans('mircle-group-list.forum.apply.submit')}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    uploadFiles(event) {\r\n        const files = Array.from(event.target.files);\r\n        files.forEach(file => {\r\n            const formData = new FormData();\r\n            formData.append('files[]', file);\r\n            app.request({\r\n                method: 'POST',\r\n                url: app.forum.attribute('apiUrl') + '/fof/upload',\r\n                body: formData,\r\n                headers: {\r\n                    'Authorization': 'Token ' + app.session.token,\r\n                },\r\n                serialize: raw => raw\r\n            }).then(response => {\r\n                // 修复：响应数据是数组，需要访问第一个元素\r\n                const fileData = response.data[0];\r\n                this.uploadedFiles.push({\r\n                    url: fileData.attributes.url,\r\n                    name: file.name,\r\n                });\r\n                m.redraw();\r\n            }).catch(error => {\r\n                console.error('Upload failed:', error);\r\n                // 修复：移除未定义的response引用\r\n                app.alerts.show({ type: 'error' }, app.translator.trans('mircle-group-list.forum.apply.upload_error'));\r\n            });\r\n        });\r\n    }\r\n\r\n    removeImage(idx) {\r\n        this.uploadedFiles.splice(idx, 1);\r\n        m.redraw();\r\n    }\r\n\r\n    onsubmit(e) {\r\n        e.preventDefault();\r\n        if (this.loading) return;\r\n        if (!this.reason().trim()) {\r\n            app.alerts.show({ type: 'error' }, app.translator.trans('mircle-group-list.forum.apply.content_required'));\r\n            return;\r\n        }\r\n        this.loading = true;\r\n        const imagesHtml = this.uploadedFiles.map(file => `<img src=\"${file.url}\" alt=\"img\" style=\"max-width:200px;margin:5px;\" />`).join('');\r\n        const fullContent = this.reason() + (imagesHtml ? '<br><br>' + imagesHtml : '');\r\n        app.request({\r\n            method: 'POST',\r\n            url: app.forum.attribute('apiUrl') + '/mircle-group-applications',\r\n            body: {\r\n                data: {\r\n                    type: 'mircle-group-applications',\r\n                    attributes: {\r\n                        groupId: this.group.id(),\r\n                        content: fullContent,\r\n                    },\r\n                },\r\n            },\r\n        }).then(() => {\r\n            this.loading = false;\r\n            app.alerts.show({ type: 'success' }, app.translator.trans('mircle-group-list.forum.apply.success'));\r\n            this.hide();\r\n        }).catch(() => {\r\n            this.loading = false;\r\n            app.alerts.show({ type: 'error' }, app.translator.trans('mircle-group-list.forum.apply.error'));\r\n        });\r\n    }\r\n} ","import Page from 'flarum/common/components/Page';\r\nimport IndexPage from 'flarum/forum/components/IndexPage';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport GroupBadge from 'flarum/common/components/GroupBadge';\r\nimport Button from 'flarum/common/components/Button';\r\nimport listItems from 'flarum/common/helpers/listItems';\r\nimport UserList from './UserList';\r\nimport GroupApplicationModal from './GroupApplicationModal';\r\n\r\n/* global app, m */\r\n\r\nexport default class GroupListPage extends Page {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n\r\n        this.items = null;\r\n\r\n        app.request({\r\n            method: 'GET',\r\n            url: app.forum.attribute('apiUrl') + '/mircle-group-list',\r\n        }).then(response => {\r\n            this.items = app.store.pushPayload(response);\r\n            m.redraw();\r\n        });\r\n\r\n        this.bodyClass = 'GroupList-page';\r\n    }\r\n\r\n    view() {\r\n        return m('.IndexPage', [\r\n            IndexPage.prototype.hero(),\r\n            m('.container', m('.sideNavContainer', [\r\n                m('nav.IndexPage-nav.sideNav', m('ul', listItems(IndexPage.prototype.sidebarItems().toArray()))),\r\n                m('.IndexPage-results.sideNavOffset.GroupList-content', this.content()),\r\n            ])),\r\n        ]);\r\n    }\r\n\r\n    content() {\r\n        if (this.items === null) {\r\n            return LoadingIndicator.component();\r\n        }\r\n\r\n        return this.items.map(item => m('div', [\r\n            m('h3.GroupList-title', [\r\n                GroupBadge.component({\r\n                    group: item.group(),\r\n                }),\r\n                ' ',\r\n                item.group().namePlural(),\r\n            ]),\r\n            item.contentHtml() ? m('.GroupList-description', m.trust(item.contentHtml())) : null,\r\n            m(UserList, {\r\n                users: item.members(),\r\n                hideBadgeId: 'group' + item.group().id(),\r\n            }),\r\n            // 添加申请按钮\r\n            this.showApplyButton(item.group()) ? m('.GroupList-apply', [\r\n                Button.component({\r\n                    className: 'Button Button--primary',\r\n                    onclick: () => {\r\n                        try {\r\n                            app.modal.show(GroupApplicationModal, {\r\n                                group: item.group()\r\n                            });\r\n                        } catch (error) {\r\n                            console.error('Error showing modal:', error);\r\n                        }\r\n                    }\r\n                }, app.translator.trans('mircle-group-list.forum.apply.button'))\r\n            ]) : null,\r\n        ]));\r\n    }\r\n\r\n    showApplyButton(group) {\r\n        // 检查用户是否有权限申请，且不在该群组中\r\n        const canApply = app.forum.attribute('canApplyToGroups') && \r\n               !app.session.user.groups().some(userGroup => userGroup.id() === group.id());\r\n        \r\n        return canApply;\r\n    }\r\n}\r\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import app from 'flarum/forum/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport withAttr from 'flarum/common/utils/withAttr';\r\n\r\n/* global m */\r\n\r\nexport default class GroupApplicationReviewModal extends Modal {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n        \r\n        this.application = this.attrs.application;\r\n        this.status = Stream('approved');\r\n        this.reviewComment = Stream('');\r\n    }\r\n\r\n    className() {\r\n        return 'GroupApplicationReviewModal Modal--small';\r\n    }\r\n\r\n    title() {\r\n        return app.translator.trans('mircle-group-list.forum.review.title');\r\n    }\r\n\r\n    content() {\r\n        // 使用传递的included数据获取相关数据\r\n        const userRelation = this.application.relationships.user;\r\n        const groupRelation = this.application.relationships.group;\r\n        const includedData = this.attrs.includedData || {};\r\n        \r\n        let user = null;\r\n        let group = null;\r\n        \r\n        // 从included数据中获取用户信息\r\n        if (userRelation && userRelation.data && includedData.users) {\r\n            const userData = includedData.users[userRelation.data.id];\r\n            if (userData) {\r\n                user = {\r\n                    id: userData.id,\r\n                    ...userData.attributes\r\n                };\r\n            }\r\n        }\r\n        \r\n        // 从included数据中获取群组信息\r\n        if (groupRelation && groupRelation.data && includedData.groups) {\r\n            const groupData = includedData.groups[groupRelation.data.id];\r\n            if (groupData) {\r\n                group = {\r\n                    id: groupData.id,\r\n                    ...groupData.attributes\r\n                };\r\n            }\r\n        }\r\n        \r\n        if (!user || !group) {\r\n            return (\r\n                <div className=\"Modal-body\">\r\n                    <p>数据加载错误，请刷新页面重试</p>\r\n                </div>\r\n            );\r\n        }\r\n        \r\n        // 安全地获取显示名称\r\n        const userName = user.displayName || user.username || 'Unknown User';\r\n        const groupName = group.nameSingular || 'Unknown Group';\r\n        \r\n        return (\r\n            <div className=\"Modal-body\">\r\n                <div className=\"GroupApplicationReviewModal-info\">\r\n                    <p>\r\n                        用户 <strong>{userName}</strong> 申请加入群组 <strong>{groupName}</strong>\r\n                    </p>\r\n                </div>\r\n                \r\n                <div className=\"GroupApplicationReviewModal-content\">\r\n                    <h4>{app.translator.trans('mircle-group-list.forum.review.application_content')}</h4>\r\n                    <div className=\"GroupApplicationReviewModal-applicationContent\" innerHTML={this.application.attributes.content} />\r\n                </div>\r\n                \r\n                <div className=\"Form-group\">\r\n                    <label>{app.translator.trans('mircle-group-list.forum.review.status_label')}</label>\r\n                    <select\r\n                        className=\"FormControl\"\r\n                        value={this.status()}\r\n                        onchange={withAttr('value', this.status)}\r\n                    >\r\n                        <option value=\"approved\">{app.translator.trans('mircle-group-list.forum.review.status.approved')}</option>\r\n                        <option value=\"rejected\">{app.translator.trans('mircle-group-list.forum.review.status.rejected')}</option>\r\n                    </select>\r\n                </div>\r\n                \r\n                <div className=\"Form-group\">\r\n                    <label>{app.translator.trans('mircle-group-list.forum.review.comment_label')}</label>\r\n                    <textarea\r\n                        className=\"FormControl\"\r\n                        rows=\"3\"\r\n                        placeholder={app.translator.trans('mircle-group-list.forum.review.comment_placeholder')}\r\n                        value={this.reviewComment()}\r\n                        oninput={withAttr('value', this.reviewComment)}\r\n                    />\r\n                </div>\r\n                \r\n                <div className=\"Form-group\">\r\n                    <Button\r\n                        className=\"Button Button--primary\"\r\n                        type=\"submit\"\r\n                        loading={this.loading}\r\n                    >\r\n                        {app.translator.trans('mircle-group-list.forum.review.submit')}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    onsubmit(e) {\r\n        e.preventDefault();\r\n        \r\n        app.request({\r\n            method: 'PATCH',\r\n            url: app.forum.attribute('apiUrl') + `/mircle-group-applications/${this.application.id}/review`,\r\n            body: {\r\n                data: {\r\n                    type: 'mircle-group-applications',\r\n                    id: this.application.id,\r\n                    attributes: {\r\n                        status: this.status(),\r\n                        reviewComment: this.reviewComment(),\r\n                    },\r\n                },\r\n            },\r\n        }).then(response => {\r\n            app.alerts.show({ type: 'success' }, app.translator.trans('mircle-group-list.forum.review.success'));\r\n            this.hide();\r\n            this.attrs.onUpdate();\r\n        }).catch(error => {\r\n            console.error('Review failed:', error);\r\n            app.alerts.show({ type: 'error' }, app.translator.trans('mircle-group-list.forum.review.error'));\r\n        });\r\n    }\r\n} ","import Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport GroupApplicationReviewModal from './GroupApplicationReviewModal';\r\n\r\nexport default class GroupApplicationItem extends Component {\r\n    view() {\r\n        const application = this.attrs.application;\r\n        \r\n        // 添加安全检查\r\n        if (!application || !application.relationships) {\r\n            return m('.GroupApplicationItem-error', \r\n                app.translator.trans('mircle-group-list.forum.applications.data_error', {}, 'Data loading error')\r\n            );\r\n        }\r\n        \r\n        // 检查application.attributes是否存在\r\n        if (!application.attributes) {\r\n            return m('.GroupApplicationItem-error', \r\n                app.translator.trans('mircle-group-list.forum.applications.missing_application_attributes', {}, 'Missing application attributes')\r\n            );\r\n        }\r\n        \r\n        // 使用传递的included数据获取相关数据\r\n        const userRelation = application.relationships.user;\r\n        const groupRelation = application.relationships.group;\r\n        const reviewerRelation = application.relationships.reviewer;\r\n        const includedData = this.attrs.includedData || {};\r\n        \r\n        let user = null;\r\n        let group = null;\r\n        let reviewer = null;\r\n        \r\n        // 从included数据中获取用户信息\r\n        if (userRelation && userRelation.data && includedData.users) {\r\n            const userData = includedData.users[userRelation.data.id];\r\n            if (userData) {\r\n                user = {\r\n                    id: userData.id,\r\n                    ...userData.attributes\r\n                };\r\n            }\r\n        }\r\n        \r\n        // 从included数据中获取群组信息\r\n        if (groupRelation && groupRelation.data && includedData.groups) {\r\n            const groupData = includedData.groups[groupRelation.data.id];\r\n            if (groupData) {\r\n                group = {\r\n                    id: groupData.id,\r\n                    ...groupData.attributes\r\n                };\r\n            }\r\n        }\r\n        \r\n        // 从included数据中获取审核者信息\r\n        if (reviewerRelation && reviewerRelation.data && includedData.users) {\r\n            const reviewerData = includedData.users[reviewerRelation.data.id];\r\n            if (reviewerData) {\r\n                reviewer = {\r\n                    id: reviewerData.id,\r\n                    ...reviewerData.attributes\r\n                };\r\n            }\r\n        }\r\n        \r\n        // 如果关键数据缺失，显示错误信息\r\n        if (!user || !group) {\r\n            return m('.GroupApplicationItem-error', \r\n                `申请数据不完整 (用户ID: ${userRelation?.data?.id || 'N/A'}, 群组ID: ${groupRelation?.data?.id || 'N/A'})`\r\n            );\r\n        }\r\n        \r\n        // 安全地获取显示名称\r\n        const userName = user.displayName || user.username || 'Unknown User';\r\n        const groupName = group.nameSingular || 'Unknown Group';\r\n        const reviewerName = reviewer ? (reviewer.displayName || reviewer.username || 'Unknown Reviewer') : app.translator.trans('mircle-group-list.forum.applications.unknown_reviewer', {}, 'Unknown');\r\n        \r\n        const statusClass = {\r\n            'pending': 'GroupApplicationItem--pending',\r\n            'approved': 'GroupApplicationItem--approved',\r\n            'rejected': 'GroupApplicationItem--rejected',\r\n        }[application.attributes.status];\r\n\r\n        return m(`.GroupApplicationItem.${statusClass}`, [\r\n            m('.GroupApplicationItem-header', [\r\n                m('.GroupApplicationItem-user', [\r\n                    m('strong', userName),\r\n                    ' ',\r\n                    app.translator.trans('mircle-group-list.forum.applications.applying_to'),\r\n                    ' ',\r\n                    m('strong', groupName)\r\n                ]),\r\n                m('.GroupApplicationItem-status', \r\n                    app.translator.trans(`mircle-group-list.forum.applications.status.${application.attributes.status}`)\r\n                )\r\n            ]),\r\n            \r\n            m('.GroupApplicationItem-content', [\r\n                m('.GroupApplicationItem-text', {\r\n                    innerHTML: application.attributes.content\r\n                })\r\n            ]),\r\n            \r\n            m('.GroupApplicationItem-meta', [\r\n                m('span.GroupApplicationItem-date', \r\n                    app.translator.trans('mircle-group-list.forum.applications.submitted_on', {\r\n                        date: application.attributes.createdAt ? \r\n                            new Date(application.attributes.createdAt).toLocaleString('zh-CN', {\r\n                                year: 'numeric',\r\n                                month: '2-digit',\r\n                                day: '2-digit',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit'\r\n                            }) : '未知时间'\r\n                    })\r\n                ),\r\n                \r\n                application.attributes.reviewedAt ? m('span.GroupApplicationItem-reviewed', \r\n                    `审核人：${reviewerName}，审核时间：${application.attributes.reviewedAt ? \r\n                        new Date(application.attributes.reviewedAt).toLocaleString('zh-CN', {\r\n                            year: 'numeric',\r\n                            month: '2-digit',\r\n                            day: '2-digit',\r\n                            hour: '2-digit',\r\n                            minute: '2-digit'\r\n                        }) : '未知时间'}`\r\n                ) : null\r\n            ]),\r\n            \r\n            application.attributes.reviewComment ? m('.GroupApplicationItem-review', [\r\n                m('strong', app.translator.trans('mircle-group-list.forum.applications.review_comment') + ':'),\r\n                m('.GroupApplicationItem-reviewComment', {\r\n                    innerHTML: application.attributes.reviewComment\r\n                })\r\n            ]) : null,\r\n            \r\n            application.attributes.status === 'pending' && app.forum.attribute('canReviewApplications') ? \r\n                m('.GroupApplicationItem-actions', [\r\n                    Button.component({\r\n                        className: 'Button Button--primary',\r\n                        onclick: () => app.modal.show(GroupApplicationReviewModal, {\r\n                            application: application,\r\n                            includedData: this.attrs.includedData,\r\n                            onUpdate: this.attrs.onUpdate\r\n                        })\r\n                    }, app.translator.trans('mircle-group-list.forum.applications.review'))\r\n                ]) : null\r\n        ]);\r\n    }\r\n} ","import Page from 'flarum/common/components/Page';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport GroupApplicationItem from './GroupApplicationItem';\r\n\r\nexport default class GroupApplicationListPage extends Page {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n        \r\n        this.applications = [];\r\n        this.loading = false;\r\n        this.statusFilter = 'all'; // 添加状态筛选器\r\n        this.includedData = {}; // 存储included数据\r\n        this.loadApplications();\r\n    }\r\n\r\n    loadApplications() {\r\n        this.loading = true;\r\n        m.redraw();\r\n\r\n        // 构建API URL，添加状态筛选参数\r\n        let url = app.forum.attribute('apiUrl') + '/mircle-group-applications?include=user,group,reviewer';\r\n        if (this.statusFilter !== 'all') {\r\n            if (this.statusFilter === 'my') {\r\n                // 我的申请：筛选当前用户的申请\r\n                url += '&filter[user]=' + app.session.user.id();\r\n            } else {\r\n                // 状态筛选\r\n                url += '&filter[status]=' + this.statusFilter;\r\n            }\r\n        }\r\n\r\n        app.request({\r\n            method: 'GET',\r\n            url: url,\r\n        }).then(response => {\r\n            // 将included数据存储起来\r\n            this.includedData = {};\r\n            if (response.included) {\r\n                response.included.forEach(item => {\r\n                    if (!this.includedData[item.type]) {\r\n                        this.includedData[item.type] = {};\r\n                    }\r\n                    this.includedData[item.type][item.id] = item;\r\n                });\r\n            }\r\n            \r\n            this.applications = response.data;\r\n            this.loading = false;\r\n            m.redraw();\r\n        }).catch(error => {\r\n            console.error('Failed to load applications:', error);\r\n            this.loading = false;\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    onStatusFilterChange(newStatus) {\r\n        this.statusFilter = newStatus;\r\n        this.loadApplications();\r\n    }\r\n\r\n    view() {\r\n        const isReviewer = app.forum.attribute('canReviewApplications');\r\n        const pageTitle = isReviewer ? \r\n            app.translator.trans('mircle-group-list.forum.applications.title') :\r\n            app.translator.trans('mircle-group-list.forum.applications.my_title', {}, '我的群组申请');\r\n        \r\n        // 根据筛选状态调整空状态文本\r\n        let emptyText;\r\n        if (this.statusFilter === 'all') {\r\n            emptyText = isReviewer ? '暂无申请记录' : '您暂无申请记录';\r\n        } else if (this.statusFilter === 'my') {\r\n            emptyText = '您暂无申请记录';\r\n        } else {\r\n            const statusNames = {\r\n                'pending': '待审核',\r\n                'approved': '已批准', \r\n                'rejected': '已拒绝'\r\n            };\r\n            emptyText = `暂无${statusNames[this.statusFilter]}的申请`;\r\n        }\r\n        \r\n        // 申请数量统计\r\n        const applicationCount = this.applications.length;\r\n        const countText = this.loading ? '' : `(${applicationCount} 条)`;\r\n            \r\n        return m('.GroupApplicationListPage', [\r\n            m('.container', [\r\n                m('.GroupApplicationListPage-header', [\r\n                    m('h1', [pageTitle, ' ', m('span.GroupApplicationListPage-count', countText)]),\r\n                    // 添加状态筛选器\r\n                    m('.GroupApplicationListPage-filters', [\r\n                        m('.GroupApplicationListPage-filterButtons', [\r\n                            m('button.Button.GroupApplicationListPage-filterButton', {\r\n                                className: this.statusFilter === 'all' ? 'Button--primary' : '',\r\n                                onclick: () => this.onStatusFilterChange('all')\r\n                            }, [\r\n                                m('span.GroupApplicationListPage-filterText', '全部')\r\n                            ]),\r\n                            m('button.Button.GroupApplicationListPage-filterButton', {\r\n                                className: this.statusFilter === 'pending' ? 'Button--primary' : '',\r\n                                onclick: () => this.onStatusFilterChange('pending')\r\n                            }, [\r\n                                m('i.fas.fa-clock.GroupApplicationListPage-filterIcon'),\r\n                                m('span.GroupApplicationListPage-filterText', '待审核')\r\n                            ]),\r\n                            m('button.Button.GroupApplicationListPage-filterButton', {\r\n                                className: this.statusFilter === 'approved' ? 'Button--primary' : '',\r\n                                onclick: () => this.onStatusFilterChange('approved')\r\n                            }, [\r\n                                m('i.fas.fa-check.GroupApplicationListPage-filterIcon'),\r\n                                m('span.GroupApplicationListPage-filterText', '已批准')\r\n                            ]),\r\n                            m('button.Button.GroupApplicationListPage-filterButton', {\r\n                                className: this.statusFilter === 'rejected' ? 'Button--primary' : '',\r\n                                onclick: () => this.onStatusFilterChange('rejected')\r\n                            }, [\r\n                                m('i.fas.fa-times.GroupApplicationListPage-filterIcon'),\r\n                                m('span.GroupApplicationListPage-filterText', '已拒绝')\r\n                            ]),\r\n                            m('button.Button.GroupApplicationListPage-filterButton', {\r\n                                className: this.statusFilter === 'my' ? 'Button--primary' : '',\r\n                                onclick: () => this.onStatusFilterChange('my')\r\n                            }, [\r\n                                m('i.fas.fa-user.GroupApplicationListPage-filterIcon'),\r\n                                m('span.GroupApplicationListPage-filterText', '我的申请')\r\n                            ])\r\n                        ])\r\n                    ])\r\n                ]),\r\n                \r\n                this.loading ? \r\n                    LoadingIndicator.component() : \r\n                    m('.GroupApplicationListPage-content', \r\n                        this.applications.length === 0 ? \r\n                            m('.GroupApplicationListPage-empty', emptyText) :\r\n                            m('.GroupApplicationListPage-list', \r\n                                this.applications.map(application => \r\n                                    m(GroupApplicationItem, {\r\n                                        key: application.id,\r\n                                        application: application,\r\n                                        includedData: this.includedData,\r\n                                        onUpdate: () => this.loadApplications()\r\n                                    })\r\n                                )\r\n                            )\r\n                    )\r\n            ])\r\n        ]);\r\n    }\r\n} ","import Model from 'flarum/common/Model';\r\n \r\nexport default class GroupApplication extends Model {\r\n    apiEndpoint() {\r\n        return '/mircle-group-applications';\r\n    }\r\n} ","import {extend} from 'flarum/common/extend';\r\nimport IndexPage from 'flarum/forum/components/IndexPage';\r\nimport LinkButton from 'flarum/common/components/LinkButton';\r\nimport GroupListPage from './components/GroupListPage';\r\nimport GroupListItem from '../common/models/GroupListItem';\r\nimport GroupApplicationListPage from './components/GroupApplicationListPage';\r\nimport GroupApplicationModal from './components/GroupApplicationModal';\r\nimport GroupApplication from '../common/models/GroupApplication';\r\n\r\n/* global app */\r\n\r\napp.initializers.add('mircle-group-list', () => {\r\n    app.routes['mircle-group-list'] = {\r\n        path: '/groups',\r\n        component: GroupListPage,\r\n    };\r\n    \r\n    app.routes['mircle-group-applications'] = {\r\n        path: '/group-applications',\r\n        component: GroupApplicationListPage,\r\n    };\r\n\r\n    app.store.models['mircle-group-list-items'] = GroupListItem;\r\n    app.store.models['mircle-group-applications'] = GroupApplication;\r\n\r\n    extend(IndexPage.prototype, 'navItems', items => {\r\n        if (!app.forum.attribute('mircle-group-list.showSideNavLink')) {\r\n            return;\r\n        }\r\n\r\n        items.add('mircle-group-list-item', LinkButton.component({\r\n            href: app.route('mircle-group-list'),\r\n            icon: 'fas fa-users',\r\n        }, app.translator.trans('mircle-group-list.forum.nav')), 85);\r\n        \r\n        // 添加申请列表链接（对有申请权限或审核权限的用户显示）\r\n        if (app.forum.attribute('canApplyToGroups') || app.forum.attribute('canReviewApplications')) {\r\n            items.add('mircle-group-applications-item', LinkButton.component({\r\n                href: app.route('mircle-group-applications'),\r\n                icon: 'fas fa-clipboard-list',\r\n            }, app.translator.trans('mircle-group-list.forum.applications.nav')), 86);\r\n        }\r\n    });\r\n});\r\n"],"sourceRoot":""}